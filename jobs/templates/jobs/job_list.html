{% extends "jobs/base.html" %}
{% block title %}MarTechStack.io ‚Äî Zero-Noise MarTech Jobs{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

  <!-- HERO -->
  <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-8">
    <div class="grid lg:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl font-bold tracking-tight text-gray-900">
          The <span class="text-indigo-600">Zero-Noise</span> job board for MarTech & Marketing Ops
        </h1>
        <p class="mt-3 text-gray-600 text-lg">
          No sales spam. No generic marketing roles. Only technical & operational jobs ‚Äî screened by our Brain üß†
        </p>
        <div class="mt-6 flex flex-wrap gap-3">
          <a href="#jobs" class="inline-flex items-center rounded-xl bg-indigo-600 px-5 py-3 text-white font-semibold hover:bg-indigo-700">
            Browse Jobs
          </a>
          <a href="#alerts" class="inline-flex items-center rounded-xl bg-gray-900 px-5 py-3 text-white font-semibold hover:bg-black">
            Get Weekly Alerts
          </a>
        </div>
      </div>

      <!-- SEARCH PANEL -->
      <div class="bg-gray-50 rounded-2xl border border-gray-200 p-6">
        <form method="get" class="space-y-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700">Search</label>
            <input
              type="text"
              name="q"
              value="{{ query }}"
              placeholder="Adobe AEP, Marketing Ops, CDP Engineer‚Ä¶"
              class="mt-1 w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500"
            />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold text-gray-700">Tech Stack</label>
              <select name="tool" class="mt-1 w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                <option value="">All tools</option>
                {% for tool in tools %}
                  <option value="{{ tool.name }}" {% if tool_filter == tool.name %}selected{% endif %}>
                    {{ tool.category.name }} ‚Äî {{ tool.name }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700">Category</label>
              <select name="category" class="mt-1 w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                <option value="">All categories</option>
                {% for cat in categories %}
                  <option value="{{ cat.name }}" {% if category_filter == cat.name %}selected{% endif %}>
                    {{ cat.name }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700">Role Type</label>
              <select name="role_type" class="mt-1 w-full rounded-xl border-gray-300 focus:border-indigo-500 focus:ring-indigo-500">
                <option value="">All</option>
                <option value="full_time" {% if role_type_filter == "full_time" %}selected{% endif %}>Full-time</option>
                <option value="part_time" {% if role_type_filter == "part_time" %}selected{% endif %}>Part-time</option>
                <option value="contract" {% if role_type_filter == "contract" %}selected{% endif %}>Contract</option>
                <option value="temporary" {% if role_type_filter == "temporary" %}selected{% endif %}>Temporary</option>
                <option value="internship" {% if role_type_filter == "internship" %}selected{% endif %}>Internship</option>
              </select>
            </div>

            <div class="flex items-end">
              <label class="inline-flex items-center gap-2 text-sm font-semibold text-gray-700">
                <input type="checkbox" name="remote" value="true"
                  {% if remote_filter|lower in "true,1,yes,on" %}checked{% endif %}
                  class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                />
                Remote only
              </label>
            </div>
          </div>

          <div class="flex items-center gap-3">
            <button type="submit" class="inline-flex items-center rounded-xl bg-indigo-600 px-5 py-3 text-white font-semibold hover:bg-indigo-700">
              Search
            </button>
            <a href="/" class="text-gray-600 hover:text-gray-900 font-semibold">Clear</a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- BROWSE BY STACK -->
  <div class="mt-10">
    <h2 class="text-xl font-bold text-gray-900">Browse by stack</h2>
    <p class="text-gray-600 mt-1">Quick jumps ‚Äî add more over time.</p>

    <div class="mt-4 grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
      {% for cat in categories|slice:":6" %}
      <a href="/?category={{ cat.name|urlencode }}"
         class="bg-white border border-gray-200 rounded-xl px-4 py-3 hover:border-indigo-300 hover:shadow-sm">
        <div class="text-sm font-semibold text-gray-900">{{ cat.name }}</div>
        <div class="text-xs text-gray-500">Explore roles</div>
      </a>
      {% endfor %}
    </div>
  </div>

  <!-- JOBS -->
  <div id="jobs" class="mt-10">
    <div class="flex items-center justify-between">
      <h2 class="text-2xl font-bold text-gray-900">Jobs</h2>
      <div class="text-sm text-gray-600">
        {% if jobs.paginator %}
          {{ jobs.paginator.count }} results
        {% else %}
          {{ jobs|length }} results
        {% endif %}
      </div>
    </div>

    <!-- Active filter chips -->
    <div class="mt-3 flex flex-wrap gap-2">
      {% if query %}
        <a href="/?tool={{ tool_filter|urlencode }}&category={{ category_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}{% if remote_filter %}&remote=true{% endif %}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm">
          Search: ‚Äú{{ query }}‚Äù <span class="text-gray-500">√ó</span>
        </a>
      {% endif %}
      {% if tool_filter %}
        <a href="/?q={{ query|urlencode }}&category={{ category_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}{% if remote_filter %}&remote=true{% endif %}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm">
          Tool: {{ tool_filter }} <span class="text-gray-500">√ó</span>
        </a>
      {% endif %}
      {% if category_filter %}
        <a href="/?q={{ query|urlencode }}&tool={{ tool_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}{% if remote_filter %}&remote=true{% endif %}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm">
          Category: {{ category_filter }} <span class="text-gray-500">√ó</span>
        </a>
      {% endif %}
      {% if role_type_filter %}
        <a href="/?q={{ query|urlencode }}&tool={{ tool_filter|urlencode }}&category={{ category_filter|urlencode }}{% if remote_filter %}&remote=true{% endif %}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm">
          Role: {{ role_type_filter }} <span class="text-gray-500">√ó</span>
        </a>
      {% endif %}
      {% if remote_filter|lower in "true,1,yes,on" %}
        <a href="/?q={{ query|urlencode }}&tool={{ tool_filter|urlencode }}&category={{ category_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}"
           class="inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1 text-sm">
          Remote <span class="text-gray-500">√ó</span>
        </a>
      {% endif %}
    </div>

    <div class="mt-6 grid gap-4">
      {% for job in jobs %}
        <a href="{% url 'job_detail' job.id %}" class="block bg-white border border-gray-200 rounded-2xl p-6 hover:shadow-sm hover:border-indigo-300">
          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="text-lg font-bold text-gray-900">{{ job.title }}</div>
              <div class="mt-1 text-sm text-gray-600">{{ job.company }}{% if job.location %} ‚Ä¢ {{ job.location }}{% endif %}</div>

              <div class="mt-3 flex flex-wrap gap-2">
                {% if job.remote %}
                  <span class="rounded-full bg-emerald-50 text-emerald-700 px-3 py-1 text-xs font-semibold">Remote</span>
                {% endif %}
                <span class="rounded-full bg-indigo-50 text-indigo-700 px-3 py-1 text-xs font-semibold">{{ job.get_role_type_display }}</span>
                {% for tool in job.tools.all|slice:":4" %}
                  <span class="rounded-full bg-gray-100 text-gray-700 px-3 py-1 text-xs font-semibold">{{ tool.name }}</span>
                {% endfor %}
              </div>
            </div>

            <div class="text-right">
              <div class="text-xs text-gray-500">Posted</div>
              <div class="text-sm font-semibold text-gray-900">{{ job.created_at|date:"M j, Y" }}</div>
            </div>
          </div>
        </a>
      {% empty %}
        <div class="bg-white border border-gray-200 rounded-2xl p-8 text-gray-700">
          No jobs found. Try removing filters.
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if jobs.paginator.num_pages > 1 %}
      <div class="mt-8 flex items-center justify-between">
        <div class="text-sm text-gray-600">
          Page {{ jobs.number }} of {{ jobs.paginator.num_pages }}
        </div>
        <div class="flex gap-2">
          {% if jobs.has_previous %}
            <a class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50"
               href="?page={{ jobs.previous_page_number }}&q={{ query|urlencode }}&tool={{ tool_filter|urlencode }}&category={{ category_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}{% if remote_filter|lower in "true,1,yes,on" %}&remote=true{% endif %}">
              Prev
            </a>
          {% endif %}
          {% if jobs.has_next %}
            <a class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50"
               href="?page={{ jobs.next_page_number }}&q={{ query|urlencode }}&tool={{ tool_filter|urlencode }}&category={{ category_filter|urlencode }}&role_type={{ role_type_filter|urlencode }}{% if remote_filter|lower in "true,1,yes,on" %}&remote=true{% endif %}">
              Next
            </a>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>

  <!-- ALERTS -->
  <div id="alerts" class="mt-12 bg-gray-900 rounded-2xl p-8 text-white">
    <h3 class="text-2xl font-bold">Get weekly MarTechStack alerts</h3>
    <p class="mt-1 text-gray-200">We‚Äôll send the best Zero-Noise roles once a week.</p>
    <form method="post" action="{% url 'subscribe' %}" class="mt-5 flex flex-col sm:flex-row gap-3">
      {% csrf_token %}
      <input type="email" name="email" required placeholder="you@email.com"
             class="w-full rounded-xl px-4 py-3 text-gray-900" />
      <button type="submit" class="rounded-xl bg-indigo-600 px-6 py-3 font-semibold hover:bg-indigo-700">
        Subscribe
      </button>
    </form>
  </div>

</div>
{% endblock %}

{% extends "jobs/base.html" %}
{% block title %}Review Queue — MarTechStack.io{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="flex items-start justify-between gap-4">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Review Queue</h1>
      <p class="mt-1 text-gray-600">Approve/reject jobs screened by the Brain. This is staff-only.</p>
    </div>

    <div class="flex gap-2">
      <a href="/admin/" class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50 font-semibold">Admin</a>
      <a href="/" class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50 font-semibold">Back to site</a>
    </div>
  </div>

  <div class="mt-6 bg-white border border-gray-200 rounded-2xl p-6">
    <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
      <div>
        <label class="block text-sm font-semibold text-gray-700">Status</label>
        <select name="status" class="mt-1 w-full rounded-xl border-gray-300">
          <option value="pending" {% if status == "pending" %}selected{% endif %}>Pending</option>
          <option value="approved" {% if status == "approved" %}selected{% endif %}>Approved</option>
          <option value="rejected" {% if status == "rejected" %}selected{% endif %}>Rejected</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold text-gray-700">Search</label>
        <input type="text" name="q" value="{{ q }}" placeholder="title, company, url..."
               class="mt-1 w-full rounded-xl border-gray-300" />
      </div>
      <div class="flex gap-3">
        <button class="rounded-xl bg-indigo-600 px-5 py-3 text-white font-semibold hover:bg-indigo-700" type="submit">Filter</button>
        <a class="px-5 py-3 rounded-xl border border-gray-300 bg-white hover:bg-gray-50 font-semibold" href="/review/">Reset</a>
      </div>
    </form>
  </div>

  <div class="mt-8 space-y-4">
    {% for job in jobs %}
      <div class="bg-white border border-gray-200 rounded-2xl p-6">
        <div class="flex items-start justify-between gap-4">
          <div>
            <div class="text-lg font-bold text-gray-900">{{ job.title }}</div>
            <div class="text-sm text-gray-600">{{ job.company }}{% if job.location %} • {{ job.location }}{% endif %}</div>
            <div class="mt-2 text-xs text-gray-500 break-all">
              <a class="text-indigo-600 hover:underline" href="{{ job.apply_url }}" target="_blank" rel="noreferrer">Apply link</a>
              • Created {{ job.created_at|date:"M j, Y" }}
            </div>
          </div>

          <div class="text-right">
            <div class="text-xs text-gray-500">Score</div>
            <div class="text-2xl font-bold text-gray-900">
              {% if job.screening_score %}{{ job.screening_score|floatformat:1 }}{% else %}-{% endif %}
            </div>
            <div class="mt-1 text-xs text-gray-500">Status: {{ job.screening_status }}</div>
          </div>
        </div>

        <div class="mt-4">
          <div class="text-sm font-semibold text-gray-900">Reason</div>
          <div class="text-sm text-gray-700 mt-1">{{ job.screening_reason|default:"(no reason stored)" }}</div>
        </div>

        <div class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-4">
          <div class="bg-gray-50 border border-gray-200 rounded-xl p-4">
            <div class="text-sm font-semibold text-gray-900">Tools</div>
            <div class="mt-2 flex flex-wrap gap-2">
              {% for tool in job.tools.all %}
                <span class="rounded-full bg-white border border-gray-200 px-3 py-1 text-xs font-semibold">{{ tool.name }}</span>
              {% empty %}
                <span class="text-sm text-gray-500">None</span>
              {% endfor %}
            </div>
          </div>

          <div class="bg-gray-50 border border-gray-200 rounded-xl p-4">
            <div class="text-sm font-semibold text-gray-900">Screening details</div>
            <pre class="mt-2 text-xs text-gray-700 whitespace-pre-wrap break-words">{{ job.screening_details|default:"{}" }}</pre>
          </div>
        </div>

        <div class="mt-5 flex flex-wrap gap-2">
          <a href="/review/{{ job.id }}/approve/" class="rounded-xl bg-emerald-600 px-4 py-2 text-white font-semibold hover:bg-emerald-700">Approve</a>
          <a href="/review/{{ job.id }}/reject/" class="rounded-xl bg-rose-600 px-4 py-2 text-white font-semibold hover:bg-rose-700">Reject</a>
          <a href="/review/{{ job.id }}/pending/" class="rounded-xl bg-gray-900 px-4 py-2 text-white font-semibold hover:bg-black">Pending</a>
        </div>
      </div>
    {% empty %}
      <div class="bg-white border border-gray-200 rounded-2xl p-8 text-gray-700">
        No jobs in this queue.
      </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if jobs.paginator.num_pages > 1 %}
    <div class="mt-8 flex items-center justify-between">
      <div class="text-sm text-gray-600">Page {{ jobs.number }} of {{ jobs.paginator.num_pages }}</div>
      <div class="flex gap-2">
        {% if jobs.has_previous %}
          <a class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50"
             href="?page={{ jobs.previous_page_number }}&status={{ status }}&q={{ q|urlencode }}">Prev</a>
        {% endif %}
        {% if jobs.has_next %}
          <a class="px-4 py-2 rounded-xl border border-gray-300 bg-white hover:bg-gray-50"
             href="?page={{ jobs.next_page_number }}&status={{ status }}&q={{ q|urlencode }}">Next</a>
        {% endif %}
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}
